<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" 
	xmlns:pro="http://www.liquibase.org/xml/ns/pro" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd 
	http://www.liquibase.org/xml/ns/pro 
	http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.23.xsd 
	http://www.liquibase.org/xml/ns/dbchangelog 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.23.xsd">
	
	<changeSet author="Zeljana Milosevic" id="20240328">
	    <sql dbms="mysql">
	    
	      CREATE TABLE IF NOT EXISTS KORISNIK (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			KORISNICKO_IME VARCHAR(255) NOT NULL,
			LOZINKA VARCHAR(255) NOT NULL,
			VREME_KREIRANJA TIMESTAMP NOT NULL,
			VREME_POSLEDNJE_IZMENE TIMESTAMP
		);
		
		CREATE TABLE IF NOT EXISTS STATISTIKA (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			DATUM DATE NOT NULL,
			BROJ_POPUNJENIH_FORMULARA INT NOT NULL
		);
		
		CREATE TABLE IF NOT EXISTS FORMULAR (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			NAZIV VARCHAR(255) NOT NULL,
			VREME_KREIRANJA TIMESTAMP NOT NULL,
			VREME_POSLEDNJE_IZMENE TIMESTAMP
		);
		
		CREATE TABLE IF NOT EXISTS FORMULAR_POPUNJEN (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			ID_FORMULAR INT NOT NULL,
			VREME_KREIRANJA TIMESTAMP NOT NULL,
			VREME_POSLEDNJE_IZMENE TIMESTAMP
		);
		
		ALTER TABLE FORMULAR_POPUNJEN
			ADD CONSTRAINT FK_FOPO_FORM_ID FOREIGN KEY (ID_FORMULAR)
				REFERENCES FORMULAR(ID);
		
		CREATE TABLE IF NOT EXISTS POLJE (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			ID_FORMULAR INT NOT NULL,
			NAZIV VARCHAR(255) NOT NULL,
			PRIKAZNI_REDOSLED INT NOT NULL,
			TIP VARCHAR(255) NOT NULL,
			VREME_KREIRANJA TIMESTAMP NOT NULL,
			VREME_POSLEDNJE_IZMENE TIMESTAMP
		);
		
		ALTER TABLE POLJE
			ADD CONSTRAINT FK_POLJE_FORM_ID FOREIGN KEY (ID_FORMULAR)
				REFERENCES FORMULAR(ID);
		
		CREATE TABLE IF NOT EXISTS POLJE_POPUNJENO (
			ID INT PRIMARY KEY AUTO_INCREMENT,
			ID_FORMULAR_POPUNJEN INT NOT NULL,
			ID_POLJE INT NOT NULL,
			VREDNOST_TEKST VARCHAR(255),
			VREDNOST_BROJ DOUBLE,
			VREME_KREIRANJA TIMESTAMP NOT NULL,
			VREME_POSLEDNJE_IZMENE TIMESTAMP
		);
		
		ALTER TABLE POLJE_POPUNJENO
			ADD CONSTRAINT FK_POPO_FOPO_ID FOREIGN KEY (ID_FORMULAR_POPUNJEN)
				REFERENCES FORMULAR_POPUNJEN(ID);
		
		ALTER TABLE POLJE_POPUNJENO
			ADD CONSTRAINT FK_POPO_POLJE_ID FOREIGN KEY (ID_POLJE)
				REFERENCES POLJE(ID);
		
	    </sql>
  	</changeSet>
	
</databaseChangeLog>